<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<body>

<th:block th:fragment="renderWebpage(webpage, locale)">
  <div class="webpage">
    <!-- label of webpage: -->
    <div class="webpage-label">
      <th:block th:insert="~{::renderLocalizedText(${webpage.label}, ${locale})}"></th:block>
    </div>

    <!-- text of webpage: -->
    <th:block th:insert="~{::renderLocalizedStructuredContent(${webpage.text.localizedStructuredContent}, ${locale})}"></th:block>
  </div>
</th:block>

<th:block th:fragment="renderLocalizedText(text, locale)">
  <th:block th:if="${text}">
    <th:block th:if="${locale}">
      <th:block th:utext="${text.getText(locale)}">...</th:block>
    </th:block>
    <th:block th:unless="${locale}">
      <th:block th:utext="${text.getText()}">...</th:block>
    </th:block>
  </th:block>
</th:block>

<th:block th:fragment="renderLocalizedStructuredContent(structuredContent, locale)">
  <th:block th:if="${structuredContent}">
    <th:block th:if="${locale}">
      <th:block th:insert="~{::renderContentBlocks(${structuredContent.get(locale).contentBlocks})}"></th:block>
    </th:block>
    <th:block th:unless="${locale}">
      <th:block th:insert="~{::renderContentBlocks(${structuredContent.values().stream().findFirst().get().contentBlocks})}"></th:block>
    </th:block>
  </th:block>
</th:block>

<th:block th:fragment="renderContentBlocks(contentBlocks)">
  <th:block th:each="block, iter : ${contentBlocks}">
    <th:block th:insert="~{::renderContentBlock(${block})}"></th:block>
  </th:block>
</th:block>

<th:block th:fragment="renderContentBlock(block)">
  <th:block th:if="${block.class.simpleName == 'BlockquoteImpl'}">
    <blockquote>
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </blockquote>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'BulletListImpl'}">
    <ul>
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </ul>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'CodeBlockImpl'}">
      <pre>
        <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
      </pre>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'HardBreakImpl'}">
    <br/>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'HeadingImpl'}">
    <h1 th:if="${block.getAttribute('level') == 1}">
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </h1>
    <h2 th:if="${block.getAttribute('level') == 2}">
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </h2>
    <h3 th:if="${block.getAttribute('level') == 3}">
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </h3>
    <h4 th:if="${block.getAttribute('level') == 4}">
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </h4>
    <h5 th:if="${block.getAttribute('level') == 5}">
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </h5>
    <h6 th:if="${block.getAttribute('level') == 6}">
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </h6>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'IFrameImpl'}" th:with="attr=${block.attributes}">
    <iframe th:attr="src=${attr.get('src') != null}?${attr.get('src')}, width=${attr.get('width') != null}?${attr.get('width')}, height=${attr.get('height') != null}?${attr.get('height')}">
      [Your user agent does not support frames or is currently configured not to display frames. However, you may visit <a th:attr="href=${attr.get('src') != null}?${attr.get('src')}">the related
      document.</a>]
    </iframe>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'ListItemImpl'}">
    <li>
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </li>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'OrderedListImpl'}">
    <ol>
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </ol>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'ParagraphImpl'}">
    <p>
      <th:block th:insert="~{::renderContentBlocks(${block.contentBlocks})}"></th:block>
    </p>
  </th:block>

  <th:block th:if="${block.class.simpleName == 'TextImpl'}">
    <th:block th:if="${block.marks}">
      <th:block th:each="mark, iter : ${block.marks}">
        <th:block th:if="${mark.type} == 'link'">
          <th:block th:utext="'<a '"></th:block>
          <th:block th:each="attribute, iter : ${mark.attributes.entrySet()}">
            <th:block th:text="${attribute.key} + '='"></th:block>
            "
            <th:block th:text="${attribute.value}"></th:block>
            "
          </th:block>
          <th:block th:utext="'>'"></th:block>
        </th:block>
        <th:block th:unless="${mark.type} == 'link'" th:utext="'<' + ${mark.type} + '>'"></th:block>
      </th:block>
    </th:block>
    <th:block th:utext="${block.text}">...</th:block>
    <th:block th:if="${block.marks}">
      <th:block th:each="mark, iter : ${T(com.google.common.collect.Lists).reverse(block.marks)}">
        <th:block th:if="${mark.type} == 'link'">
          <th:block th:utext="'</a>'"></th:block>
        </th:block>
        <th:block th:unless="${mark.type} == 'link'">
          <th:block th:utext="'</' + ${mark.type} + '>'"></th:block>
        </th:block>
      </th:block>
    </th:block>
  </th:block>
</th:block>

</body>
</html>
