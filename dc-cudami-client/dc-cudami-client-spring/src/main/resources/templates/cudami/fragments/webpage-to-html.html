<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
  <body>

  <th:block th:fragment="content(page)">
    <th:block th:insert="~{::renderContents(${page.contentBlocksContainer.contents})}"></th:block>
  </th:block>

  <th:block th:fragment="renderContents(contents)">
    <th:block th:each="block, iter : ${contents}">
      <th:block th:insert="~{::renderBlock(${block})}"></th:block>
    </th:block>
  </th:block>

  <th:block th:fragment="renderBlock(block)">

    <th:block th:if="${block.class.simpleName == 'BulletListImpl'}">
      <ul>
        <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </ul>
    </th:block>

    <th:block th:if="${block.class.simpleName == 'EmbeddedCodeBlockImpl'}">
      <th:block th:utext="${block.code}">...</th:block>
    </th:block>

    <th:block th:if="${block.class.simpleName == 'HardBreakImpl'}">
      <br/>
    </th:block>

    <th:block th:if="${block.class.simpleName == 'HeadingImpl'}">
      <h1 th:if="${block.getAttribute('level') == 1}">
        <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </h1>
      <h2 th:if="${block.getAttribute('level') == 2}">
        <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </h2>
      <h3 th:if="${block.getAttribute('level') == 3}">
        <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </h3>
      <h4 th:if="${block.getAttribute('level') == 4}">
        <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </h4>
      <h5 th:if="${block.getAttribute('level') == 5}">
        <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </h5>
      <h6 th:if="${block.getAttribute('level') == 6}">
        <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </h6>
    </th:block>

    <th:block th:if="${block.class.simpleName == 'ListItemImpl'}">
      <li>
      <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </li>
    </th:block>

    <th:block th:if="${block.class.simpleName == 'OrderedListImpl'}">
      <ol>
        <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </ol>
    </th:block>

    <th:block th:if="${block.class.simpleName == 'ParagraphImpl'}">
      <p>
      <th:block th:insert="~{::renderContents(${block.contents})}"></th:block>
      </p>
    </th:block>

    <th:block th:if="${block.class.simpleName == 'TextImpl'}">
      <th:block th:if="${block.marks}">
        <th:block th:each="mark, iter : ${block.marks}">
          <th:block th:if="${mark.type} == 'link'">
            <th:block th:utext="'<a '"></th:block>
            <th:block th:each="attribute, iter : ${mark.attributes.entrySet()}">
              <th:block th:text="${attribute.key} + '='"></th:block>
              "<th:block th:text="${attribute.value}"></th:block>"
            </th:block>
            <th:block th:utext="'>'"></th:block>
          </th:block>
          <th:block th:unless="${mark.type} == 'link'" th:utext="'<' + ${mark.type} + '>'"></th:block>
        </th:block>
      </th:block>
      <th:block th:utext="${block.text}">...</th:block>
      <th:block th:if="${block.marks}">
        <th:block th:each="mark, iter : ${T(com.google.common.collect.ImmutableList).copyOf(block.marks).reverse()}">
          <th:block th:if="${mark.type} == 'link'">
            <th:block th:utext="'</a>'"></th:block>
          </th:block>
          <th:block th:unless="${mark.type} == 'link'">
            <th:block th:utext="'</' + ${mark.type} + '>'"></th:block>
          </th:block>
        </th:block>
      </th:block>
    </th:block>
  </th:block>

</body>
</html>
